<script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Identifica o Formulário e a Área de Resultados
            const form = document.getElementById('search-form');
            const resultadoDiv = document.getElementById('resultado-info');
            const imagemDiv = document.getElementById('resultado-imagem');
            
            // Mostra um estado de carregamento
            const loadingHtml = '<div class="loading-spinner"></div><p>Buscando informações com a IA...</p>';

            if (form) {
                form.addEventListener('submit', async (event) => {
                    event.preventDefault(); // IMPEDE o envio tradicional do formulário (que o Flask usava)
                    
                    // Exibe o carregamento
                    resultadoDiv.innerHTML = loadingHtml;
                    imagemDiv.innerHTML = ''; // Limpa a imagem anterior

                    // 2. Coleta os dados do Formulário
                    const formData = new FormData(form);
                    const peixeNome = formData.get('peixe');
                    const action = event.submitter.value; // Pega o valor do botão clicado ('buscar_basico' ou 'buscar_detalhes')

                    if (!peixeNome) {
                        resultadoDiv.innerHTML = '<p class="error">Por favor, digite o nome de um peixe.</p>';
                        return;
                    }

                    // 3. Monta o Objeto de Dados para enviar ao Python (api.py)
                    const dataToSend = {
                        peixe_nome: peixeNome,
                        action: action // Envia 'buscar_basico' ou 'buscar_detalhes'
                    };

                    try {
                        // 4. CHAMA A NOVA ROTA SERVERLESS (/api)
                        const response = await fetch('/api', {
                            method: 'POST', // É importante ser POST, como configuramos no api.py
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(dataToSend)
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.erro || `Erro HTTP: ${response.status}`);
                        }

                        const result = await response.json();
                        
                        // 5. PROCESSA A RESPOSTA DO PYTHON
                        if (result.erro) {
                            resultadoDiv.innerHTML = `<p class="error">❌ Erro da IA: ${result.erro}</p>`;
                        } else {
                            // Exibe a informação da IA
                            resultadoDiv.innerHTML = `<h3>Resultado da Busca para ${peixeNome}</h3><p>${result.resultado}</p>`; 

                            // Placeholder de imagem
                            imagemDiv.innerHTML = `<img src="https://source.unsplash.com/400x300/?${peixeNome},fishing" alt="${peixeNome}" class="img-fluid" />`;
                        }

                    } catch (error) {
                        resultadoDiv.innerHTML = `<p class="error">❌ Falha na comunicação com o servidor. Detalhes: ${error.message}</p>`;
                    }
                });
            }
        });
    </script>
</body>
